

<div class="w3-container">
    <div class="w3-card w3-margin">
        <div class="w3-container w3-teal">
            <h2>Juego de Preguntas</h2>
            <div id="timer" class="w3-right w3-large"> 10</div>
        </div>

        <form id="respPregunta" action="/partida/procesarRespuesta" method="post" enctype="multipart/form-data">
            <div class="question-container">
                <h3 class="question">{{{categoria}}}</h3>
                {{#pregunta}}
                    <input type="hidden" name="pregunta" value="{{id}}">
                    <h3 class="question">{{texto}}</h3>
                {{/pregunta}}

                <ul class="answers">
                    {{#respuestas}}
                        <li class="answer">
                           <button type="submit" name="respuesta" value="{{texto}}"
                                    class="padding10_20"
                                    data-correct="{{es_correcta}}" onclick="checkAnswer(this)"
                                   >
                               {{texto}}
                            </button>
                        </li>
                    {{/respuestas}}
                </ul>

            </div>

            <input type="hidden" name="time_expired" id="time_expired" value="0">
        </form>

        <div>
            <h1 class="mensaje displayNone" >Mensaje</h1>
        </div>

    </div>
</div>

<script>
    let timeLeft = 2000;
    let timer = document.getElementById('timer'); // aca es donde se muestra el tiempo restante
    let timeExpiredInput = document.getElementById('time_expired'); // se utiliza para indicar si el tiempo se expiró
    let form = document.getElementById('respPregunta');
    const mensaje = document.querySelector('.mensaje');

    let countdown = setInterval(function () { // se utiliza para ejecutar una funcion cada segundo
        if (timeLeft <= 0) { // si timeLeft es 0 o menos entonces se detiene el temporizador y establace el valor del campo ocuilto
            clearInterval(countdown);
            timeExpiredInput.value = "1";
            form.submit(); // lo mando al back
        } else { // si es mayor a cero actualiza el contenido del elemento timer para mostrar el tiempo restante (CREO)
            timer.innerHTML = timeLeft;
        }
        timeLeft -= 1;
    }, 1000);

    function checkAnswer( button) {
        //Obtener todos los botones de respuesta
        const buttons = document.querySelectorAll('.answer button');

        // Marque el botón hecho clic
        if (button.dataset.correct === "0") {
            button.classList.add('rojoImportant');

            mensaje.classList.remove("displayNone");
            mensaje.textContent = "Incorrecto";
            mensaje.style.color = "red";

            setTimeout(function() {
                // Reanudar el envío del formulario después de 1,5 segundos
                button.closest('form').submit();
            }, 3000);
        }else{
            button.classList.add('verdeImportat');
            mensaje.classList.remove("displayNone");
            mensaje.textContent = "Correcto";
            mensaje.style.color = "green";
        }

        // Marque todas las respuestas y resalte la correcta.
        buttons.forEach(btn => {
            if (btn.dataset.correct === "1") {
                //btn.classList.add('highlight-correct');
                //btn.style.backgroundColor = 'green';
                btn.classList.add('verdeImportat');
            }
        });

    }




</script>